Power BI Desktopからの移行について
2021-09-30
ダニエル・オティキエ
Power BI Desktopでのデータモデリングの概念にすでに慣れている場合、この記事はデータモデリングをTabular Editorに移行する際に役立つことを目的としています。したがって、Power Query Editor、インポートされたテーブルと計算されたテーブル、計算された列、メジャーなどの概念をしっかりと理解していることを前提としています。

Power BIとタビュラエディタ
歴史的に、Tabular Editorは、SQL Server Analysis Services（Tabular）やAzure Analysis Servicesの開発者向けのツールとして設計されました。Power BIの発売当初、サードパーティツールがPower BIのデータモデルをホストするAnalysis Servicesインスタンスにアクセスする方法はサポートされていなかったため、Power BIのデータセットを作成・編集するには、Power BI Desktopを使用するしかありませんでした。

これが変わったのは、2020年3月にMicrosoftがPower BI Premiumに読み書き可能なXMLAエンドポイントを発表してからです。その数か月後には、外部ツール機能が発表され、Power BI Desktopと連携してサードパーティのツールを使用することも可能になりました。

Power BI PremiumでXMLAエンドポイントが利用できるようになったことで、データモデル開発者は既存のスキルやツールを活用できるようになりましたが、MicrosoftがPower BI PremiumをAnalysis Servicesのスーパーセットにするために多額の投資をしていることは、周知の事実です。言い換えれば、コミュニティツールや商用ツールなどのサードパーティツールとPower BIとの統合は、今後も継続されるものです。実際、Microsoft AnalyticsのCTOであるAmir Netz氏は、SQLBIの創設者であるMarco Russo氏と共同声明を発表し、この点を肯定しています。

ここTabular Editor ApSでは、Tabular Editor 3が現在入手可能な最高のタブラーデータモデリングツールであると確信しており、上述の統合のおかげで、このツールはもはやSQL ServerやAzure Analysis Servicesの開発者だけのものではありません。

先に進む前に、Tabular EditorがPower BIと連携して、2つの全く異なるシナリオで使用できることを理解することが重要です。

シナリオ1：Power BI Desktopの外部ツールとしてのTabular Editor。
シナリオ2：Power BI PremiumのXMLAエンドポイントを使用したTabular Editor。
重要な点
Tabular Editorを使用して、.pbixファイルを直接読み込むことはできません。詳細については、「Power BI Desktop の制限事項」を参照してください。

シナリオ1：Power BI Desktopの外部ツールとしてのTabular Editor
一般的にこのシナリオは、Power BI PremiumにアクセスできないセルフサービスのアナリストやPower BI Desktopユーザーを対象としており、特定のデータモデリング操作を容易にしたり（例：メジャーの追加と編集）、他では利用できない高度なモデリングオプション（計算グループ、パースペクティブ、メタデータの変換）を解除したりします。

外部ツールは、Power BI DesktopがホストするAnalysis Servicesモデルに接続します。これにより、ツールはデータモデルに特定の変更を加えることができます。ただし、現在のところ、Power BI Desktopでは、すべての種類のデータモデリング操作がサポートされているわけではありません。この制限と、Power BI Desktopの外部ツールとして使用した場合のTabular Editorの動作を理解しておくことが重要です。これについての詳細は、「Power BI Desktopの制限」を参照してください。

このシナリオでの典型的なワークフローは次のとおりです。

Power BI Desktopで.pbitまたは.pbixファイルを開く
外部ツール」リボンからTabular Editorを起動する
必要な変更の種類に応じて、Tabular EditorとPower BI Desktopの間を行き来する。例えば、Tabular Editorでメジャーを追加・編集することはできますが、モデルに新しいテーブルを追加する必要がある場合は、Power BI Desktopを使用する必要があります。
Tabular Editorで変更した場合は、「ファイル」→「保存」（CTRL+S）で変更内容をPower BI Desktopに書き戻します。
変更が終わったら、Tabular Editorを閉じます。その後、Power BI Desktopから通常通りレポートを発行または保存します。
注意事項
2021年10月現在、Power BI Desktopにはバグがあり、外部ツールで行った変更を反映させるために、フィールドリストやビジュアルをDesktopが自動的に更新できないことがあります。この問題が発生した場合、.pbixファイルを保存して再度開くか、モデル内のテーブルを手動で更新すると、通常はフィールドリストとすべてのビジュアルが正しく更新されます。

外部ツールに適用されるモデリングの制限は、書き込み操作/モデルの修正に関してのみ関係します。このガイドで後述するように、テーブルデータのプレビュー、ピボットグリッド、DAXクエリを通じてモデル内のデータを参照するには、Tabular Editor 3の接続機能を使用することができます。

シナリオ2：Power BI Premium XMLAエンドポイントを使用したTabular Editor
このシナリオは、Power BI Premium CapacityまたはPower BI Premium-Per-Userワークスペースを使用している組織のBI担当者が、データセット開発の目的でPower BI Desktopを完全に置き換えることを想定しています。

基本的に、Power BI Premium XMLAエンドポイントは、Analysis Services（Tabular）のインスタンスを公開します。このシナリオでは、Tabular Editorの動作は、Azure Analysis ServicesやSQL Server Analysis Services（Tabular）に接続した場合と変わりません。

このシナリオでの典型的なワークフローは、次のようになります。

Tabular Editorに初めて移行する際、XMLAエンドポイントを使用してTabular EditorでPower BIデータセットを開き、モデルのメタデータをファイル（Model.bim）またはフォルダ（Database.json）として保存します。詳しくは、「GitとSave to Folderを使った並行開発の実現」を参照してください。
今後は、ステップ1で保存したファイルまたはフォルダからTabular Editorでモデルのメタデータを開きます。オプションでワークスペースモードを使用します。
タビュラー・エディターを使って変更を適用します。
ワークスペース・モードを使用している場合は、Tabular Editorで保存（CTRL+S）を押すたびに、Power BIサービスで変更がすぐに表示されるはずです。
ワークスペース・モードを使用していない場合、または変更を終えた場合は、Tabular Editorの「モデル」＞「デプロイ...」オプションを使用して、Power BIサービスに変更を公開します。
このシナリオでは、モデルのメタデータの「ソース・オブ・トゥルース」が、ディスク上に保存されているファイルやフォルダー構造であるため、バージョンコントロール統合による並行開発だけでなく、Azure DevOpsなどの自動ビルドサーバーを使用した継続的統合/継続的デプロイメント（CI/CD）も可能です。詳細は、「Power BI CI/CD with Azure DevOps and Tabular Editor」を参照してください。

警告
Power BI サービスの XMLA エンドポイントを使用して Power BI データセットに変更を適用すると、そのデータセットは .pbix ファイルとしてダウンロードできなくなります。詳細については、「XMLA エンドポイントによるデータセットの接続性」を参照してください。

XMLAエンドポイント経由でデータセットに接続するためにTabular Editorを使用する場合は、書き込み操作やモデル修正の種類に制限はありません。

この記事の残りの部分では、データモデル開発におけるPower BI DesktopとTabular Editorの違いに焦点を当てています。Power BI Desktopの外部ツールとしてTabular Editorを使用する場合（シナリオ1）に適用されるモデリングの制限があるため、シナリオ2にのみ適用されるセクションもあります。

タビュラー・エディター3のユーザーインターフェース
Tabular Editorを初めて使用する場合は、以下のリソースに目を通してTabular Editor 3のユーザーインターフェースを理解することをお勧めします。

Getting to know Tabular Editor 3's User Interface（タブラーエディター3のユーザーインターフェイスを知る
TOMエクスプローラビュー
プロパティビュー
DAXエディタ
タブラー・エディター3のハウツー
以下は、Tabular Editor 3で一般的なタスクを実行する方法を簡単に説明したものです。

メジャーを追加する方法
モデルに新しいメジャーを追加するには、TOMエクスプローラで新しいメジャーを配置するテーブルを右クリックし、「作成」＞「メジャー」（ショートカットALT+1）を選択します。メジャーが追加されたら、すぐにメジャーの名前を入力することができます。

.../images/add-measure.png

小節の名前を変更する方法
小節（またはその他のオブジェクト）の名前を編集する必要がある場合は、単に小節を選択して F2 を押します（または小節名をダブルクリックします）。複数のオブジェクトが選択されている場合は、バッチリ名前変更ダイアログが表示され、複数のオブジェクトの名前を一度に簡単に変更することができます。

.../images/batch-rename.png

警告
データ モデル内のオブジェクト名を変更すると、名前が変更されたオブジェクトの 1 つまたは複数に依存しているレポート ビジュアルが動作しなくなることがあります。外部ツールは Power BI ビジュアルに関する情報にアクセスできないため、Tabular Editor はビジュアルで使用されているオブジェクトの名前を変更したり削除したりする前に警告を出すことができません。

メジャーのコピーを作成する方法
Tabular Editor 3では、おなじみの切り取り（CTRL+X）、コピー（CTRL+C）、貼り付け（CTRL+V）の操作で、オブジェクトを素早く移動したり、コピーを作成したりすることができます。また、TOMエクスプローラを使って、テーブルや表示フォルダ間でオブジェクトをドラッグすることもできます。途中で間違えた場合は、元に戻す(CTRL+Z)とやり直し(CTRL+Y)のオプションを(繰り返し)使用して、適用された変更の履歴を前後に移動することができます。

メジャーの DAX 式を変更する方法
TOMエクスプローラで修正したい小節を探し、選択します。隠しオブジェクトの表示(CTRL+6)とフォルダの表示(CTRL+5)は、TOMエクスプローラの上部にあるツールバー・ボタンで切り替えることができます。また、検索ボックスにメジャーの部分名を入力して、TOMエクスプローラをフィルタリングすることもできます。

メジャーが選択されると、式エディタにメジャーのDAX式が表示され、プロパティ・グリッドに「説明」、「フォーマット文字列」、「隠し」などのさまざまなプロパティが表示されます。

.../images/modify-measure.png

DAX 式を修正するには、Expression Editor にカーソルを置いて、DAX コードを更新するだけです。F6を押すと、コードが自動的にフォーマットされます。TOMエクスプローラで別のオブジェクトを選択するか、緑のチェックマークボタンExpression > Accept (F5)をクリックすると、式の変更がTabular Editorにローカルに保存されます。また、赤い「X」を押して、Expression > Cancelとすることで、行った修正をキャンセルすることができます。誤って [Accept] を押してしまった場合は、[Edit] > [Undo] (CTRL+Z) でいつでも変更を取り消すことができます。

変更した内容をPower BI Desktop、Power BI XMLAエンドポイント、またはモデルを読み込んだディスク上のファイルに保存するには、「ファイル」＞「保存」（CTRL+S）を押します。

DAXコードを記述する際の式エディタの機能については、「DAXエディタ」を参照してください。

メジャー間の依存関係を視覚化する方法
TOMエクスプローラでメジャーを選択した状態で、「メジャー」>「依存関係を表示」(SHIFT+F12)オプションを使用します。これにより、新しいウィンドウがポップアップし、そのメジャーのDAX式の依存関係ツリーが可視化されます。上流と下流の両方の依存関係の表示を切り替えることができます。

.../images/show-dependencies.png

依存関係ビューのアイテムをダブルクリックすると、TOMエクスプローラでそのオブジェクトに移動します。

メジャーのフォーマット文字列を変更する方法
TOMエクスプローラで変更したいメジャーを探して選択します。隠しオブジェクトの表示(CTRL+6)とフォルダの表示(CTRL+5)は、TOMエクスプローラの上部にあるツールバー・ボタンを使って切り替えることができます。また、検索ボックスにメジャーの部分名を入力して、TOMエクスプローラをフィルタリングすることもできます。

メジャーを選択したら、プロパティ・グリッドで「フォーマット・ストリング」プロパティを見つけて展開し、好みに応じてフォーマット・ストリング・プロパティを設定します。フォーマット・プロパティの右にあるドロップダウン・ボタンに注目してください。形式文字列プロパティ自体に形式文字列を自由に入力することもできます。

.../images/format-string.png

複数のメジャーの DAX 式を修正する方法
Tabular Editor 3 では、複数のメジャーを選択して DAX スクリプトを作成することができ、選択したすべてのメジャーの DAX 式やさまざまなプロパティを一度に変更することができます。

既存のメジャーに基づいてDAXスクリプトを作成するには、TOMエクスプローラでメジャーを選択します（CTLRキーを押しながら複数のオブジェクトを選択するか、SHIFTキーを押しながらオブジェクトの範囲を選択します）。次に、右クリックして「Script DAX」を押します。

.../images/script-dax.png

Description、FormatString、Visible、DetailRows などのプロパティを、スクリプト内で直接追加または変更できます。

F5を押して、スクリプトをデータモデルに適用します。エクスプレッションエディタとは異なり、別のオブジェクトに移動しても、スクリプトに加えられた変更は自動的に適用されないことに注意してください。DAX スクリプトによって適用された変更をロールバックするには、[編集] > [元に戻す] (CTRL+Z) オプションを使用することができます。

詳細は、「DAX スクリプト機能の使用」を参照してください。

表のデータをプレビューする方法
表の内容を表示するには（Power BI Desktopの［データ］タブに似ています）、表を右クリックして［データをプレビュー］を選択するだけです。これにより、表の内容のプレビューを含む新しいタブが開きます。表のすべての行をスクロールしたり、列にソートやフィルタリングを適用したりすることができます。Power BI Desktopとは異なり、これらのプレビュータブはいくつでも開くことができ、ユーザーインターフェイス上で隣り合って配置することができます。プレビューは、DirectQueryモードのテーブルにも対応しています（ただし、プレビューの対象は最初の100レコードに限られます）。

.../images/preview-data.png

注意
データのプレビュー機能は、Tabular Editor が Power BI Desktop または Power BI XMLA エンドポイントのデータセットに接続されている場合にのみ使用できます。

詳細は、「データの更新、プレビュー、クエリ」を参照してください。

計算グループを追加する方法
計算グループは、修正されたDAXフィルタ・コンテキストやその他のタイプのビジネス・ロジックをすべてのモデル・メジャーで定義し、再利用するのに便利です。タブラエディタを使用して計算グループを追加するには、単純に「モデル」>「新規計算グループ」（ALT+7）オプションを使用します。

.../images/add-calc-group.png

計算グループに名前を付け、TOMエクスプローラで計算グループを選択した状態で、「計算グループテーブル」＞「作成」＞「計算アイテム」オプションを使用して新しい計算アイテムを追加します。計算項目をコピー(CTRL+C)およびペースト(CTRL+V)することで、このプロセスを高速化して項目を追加することができます。

.../images/add-calc-item.png

新しいテーブルを追加するには
新しいテーブルをモデルに追加するには、[モデル] > [テーブルのインポート...]オプションを使用します。Tabular Editorのテーブルのインポートウィザードがこのプロセスを案内してくれます。

注意
Tabular Editor 3は、Power BIでサポートされていないすべてのデータソースをサポートしているわけではありません。モデルがTabular Editorでサポートされていないデータソースを使用している場合、同じソースから新しいテーブルをインポートする最も簡単な方法は、Tabular Editorで既存のテーブルをコピーし（CTRL+C / CTRL+V）、以下に示すようにパーティション式を修正してテーブルスキーマを更新することです。この作業を行うには、[ツール] > [環境設定] > [スキーマ比較] > [変更検出に Analysis Services を使用] オプションが有効になっていることを確認してください。詳細は、「（チュートリアル）テーブルのインポート」を参照してください。

重要事項
外部ツールによるテーブルの追加/編集はPower BI Desktopではサポートされていないため、Tabular Editorを外部ツールとして使用する場合、このオプションはデフォルトでは使用できません。

詳細は、「テーブルのインポートとデータモデリング」を参照してください。

テーブル上のPower Query式を修正する方法
各テーブルに読み込まれる内容を定義するPower Query（M）式は、対応するテーブルのパーティションに存在します。パーティションは、TOMエクスプローラで探すことができます。パーティションを選択すると、Tabular EditorはそのパーティションのM式をExpression Editorに表示し、編集することができます。式の変更を編集して受け入れた後、更新されたPower Query式に基づいて、テーブルにインポートされた列が変更されるべきかどうかを検出するために、TOMエクスプローラでパーティションを右クリックして、「テーブルスキーマの更新...」オプションを選択することができます。

../images/power-query-update-schema.png

注意
現在、Tabular Editor 3 はパーティション式の検証を行いません。Power Query (M)式については、Tabular Editor 3の後のアップデートで実施する予定です。

重要事項
外部ツールによるパーティションの編集はPower BI Desktopではサポートされていないため、Tabular Editorを外部ツールとして使用する場合、パーティション式はデフォルトで読み取り専用になります。

Power Query式の変更により、インポートされたテーブルの列に変更が生じた場合、その変更を確認できるダイアログが表示されます。

../images/combin-sourcecolumn-update.png

共有 Power Query 式の変更方法
共有式は、テーブルへのデータのロードに直接使用されない M クエリです。たとえば、Power BI Desktop で Power Query パラメータを作成すると、このパラメータの M 式が Shared Expression として保存されます。Tabular Editorでは、TOM ExplorerのShared Expressionsフォルダからこれらにアクセスし、パーティション上のMクエリと同様に編集することができます。

.../images/shared-expression.png

重要事項
外部ツールによるパーティションの編集はPower BI Desktopではサポートされていないため、Tabular Editorを外部ツールとして使用する場合、共有式はデフォルトで読み取り専用になります。

テーブル間にリレーションシップを追加する方法
2つのテーブルの間にリレーションシップを追加する最も簡単な方法は、新しいダイアグラムを作成し、2つのテーブルをダイアグラムに追加し、一方のテーブルからもう一方のテーブルにカラムを視覚的にドラッグして、リレーションシップに参加するべきカラムを示すことです。これは、Power BI Desktopでリレーションシップを作成する方法と同様です。

新しいダイアグラムを作成するには、「ファイル」→「新規作成」→「ダイアグラム」オプションを使用します。
テーブルをダイアグラムに追加するには、TOMエクスプローラからテーブルをドラッグ＆ドロップするか、「ダイアグラム」→「テーブルの追加...」オプションを使用します。
テーブルが追加されたら、(多面的な)ファクトテーブルの列を探し、(一面的な)ディメンションテーブルの対応する列にドラッグします。
関係の設定を確認し、「OK」をクリックします。
.../images/create-relationship-through-diagram.gif

詳細は、「ダイアグラムの操作」を参照してください。

重要なこと
Power BI Desktopでは、外部ツールによるリレーションシップの編集はサポートされていないため、Tabular Editorを外部ツールとして使用する場合は、リレーションシップを変更することはできません。

Power BIサービスに公開する方法
Power BI Serviceでデータセットを発行または更新するには、［モデル］＞［デプロイ...］オプションを使用し、データセットを発行するワークスペースのXMLAエンドポイントを使用します。

XMLAエンドポイントからモデルのメタデータを直接読み込んだ場合は、ファイル＞保存（CTRL+S）を押すだけで、Tabular Editorで読み込んだデータセットを更新することができます。

注意
Tabular Editor 3 Desktop Editionは、Power BI Desktopの外部ツールとしての使用のみを目的としているため、「モデル」 > 「デプロイ...」オプションは利用できません。詳細はこちら

次のステップ
ユーザーインターフェース
GitとSave to Folderを使った並行開発の実現
Tabular Editor 3で生産性を高める
(チュートリアル）Power BIデータセットの作成