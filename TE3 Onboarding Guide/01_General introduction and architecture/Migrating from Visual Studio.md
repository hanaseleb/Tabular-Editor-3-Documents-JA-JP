Visual Studioからの移行／SQL Server Data Toolsからの移行
2021-09-30
ダニエル・オティキエ
この記事では、Analysis Services Projects for Visual Studio（旧称：SQL Server Data Tools）を使用したTabularモデルの開発に慣れていることを前提としています。これは、SQL Server Analysis Services（Tabular）またはAzure Analysis Servicesを使用する開発者に共通しています。

Visual Studio を Tabular モデルの開発に使用したことがない場合は、このトピックをスキップしても問題ありません。
Tabular Editor 2.xをTabularモデルの開発に使用したことがある場合は、「Tabular Editor 2.xからの移行」の記事に直接進むことをお勧めします。
部分的な移行
Tabular Editor 3には、タブラーモデル開発のためにVisual Studioから完全に移行できる機能があります。これはTabular Editor 2.xとは対照的で、テーブルのインポート、リレーションシップの視覚化、データのプレビューなどのためにVisual Studioを使用することを好むユーザーもいました。

しかし、Tabular Editor 3に慣れてくると、時々Visual Studioでタブラーモデルを開くのが便利だと感じるようになるかもしれません。これは、Tabular Editor 3がVisual Studioで使用されているModel.bimファイル形式（別名TOM JSON）を変更しないため、Visual Studioとの互換性が確保されており、いつでも可能です。

唯一の例外は、Tabular EditorのSave-to-folder機能を使用する場合で、このファイル形式はVisual Studioではサポートされていません。しかし、Tabular EditorのFile > Save As...オプションを使用すれば、Visual Studioで使用するModel.bimファイルを簡単に再作成することができます。この逆の変換は、Tabular EditorでModel.bimファイルをロードし、ファイル > フォルダに保存...オプションを使用して行うこともできます。

ファイルフォーマット変換の自動化
Tabular Editorのフォルダベースのフォーマット（database.json）とVisual Studioのファイルフォーマット（model.bim）の間で変換する必要がよくある場合は、Tabular Editor 2.x CLIを使って小さなWindowsコマンドスクリプトを書き、変換プロセスを自動化することを検討してください。

model.bimからフォルダへ フォルダからmodel.bimへ
model.bimからdatabase.json（フォルダベースのフォーマット）に変換する場合。

tabulareditor.exe model.bim -F database.json
注意
上記のコマンドラインスクリプトは、Tabular Editor 2.xがインストールされていることを前提としています。タブラー・エディター2.xのインストール場所は、PATH環境変数の一部として指定する必要があります。

統合ワークスペース サーバー
Visual Studio で新しい Analysis Services (Tabular) プロジェクトを開始すると、Visual Studio の統合ワークスペース サーバーを使用するか、独自の Analysis Services のインスタンスを用意するかを選択するように求められます。さらに、表形式モデルの互換性レベルを決定する必要があります（以下のスクリーンショットを参照）。

.../images/vs-new-project.png

一方、Tabular Editorで新しいモデルを作成する場合、ワークスペース・サーバーの使用は完全に任意です（ただし、推奨されます - ワークスペース・モードを参照）。

以下は、Tabular Editor 3で新しいモデルを作成するときに表示されるダイアログボックスです。

../images/new-model.png

Use workspace databaseオプションを有効にすると、Tabular Editorはモデルの作業中にワークスペース データベースとして使用するAnalysis Servicesインスタンスとデータベース名の入力を求めます。このオプションを有効にしないと、「オフライン」モードでモデルを作成して作業することができ、テーブルやリレーションシップの追加、DAX 式の作成などを行うことができます。ただし、オフライン モデルを Analysis Services のインスタンスにデプロイしてから、モデル内のデータの更新、プレビュー、クエリを実行する必要があります。

重要事項
Tabular Editor 3には、Visual Studioの統合ワークスペース・オプションに相当する機能はありません。基本的に、統合ワークスペースは、Visual Studioで管理されるAnalysis Servicesインスタンスです。Analysis ServicesはMicrosoftの独占的ソフトウェアであるため、Tabular Editor 3と一緒に出荷することはできません。代わりに、Tabular Editorで使用するAnalysis Servicesのローカルインスタンスを実行したい場合は、SQL Server Developer Editionをインストールすることをお勧めします。

互換性レベルの要件
Tabular Editorでは、Analysis Servicesデータベースを作成する際に、以下の互換性レベルを選択することができます。

1200 (Azure Analysis Services / SQL Server 2016+)
1400 (Azure Analysis Services / SQL Server 2017+)
1500 (Azure Analysis Services / SQL Server 2019+)
さらに、Tabular Editorでは、XMLAエンドポイントを通じてPower BIサービスにデプロイされるPower BIデータセットに適した互換性レベルを選択することができます。

注
Tabular Editorは、Tabular Object Model（TOM）メタデータ形式を使用していないため、1200未満の互換性レベルをサポートしていません。互換性レベル1100または1103のモデルの開発をVisual StudioからTabular Editorに移行する予定の場合、Tabular Editorに移行する前に互換性レベルを1200以上にアップグレードする必要があります。そうすることで、モデルをSQL Server 2014 Analysis Servicesに展開することができなくなります。

Visual Studio プロジェクト
Visual Studio で Analysis Services（Tabular）プロジェクトを作成すると、プロジェクトフォルダ内で Model.bim ファイルの隣にいくつかのファイルが作成されます。これらのファイルには、Tabularオブジェクトモデル（TOM）とは関係のないプロジェクトやユーザー固有の情報が含まれています。以下のスクリーンショットは、Visual Studioで新しいタブラープロジェクトを作成した際に作成されるファイルを示しています。

.../images/vs-file-structure.png

Tabular Editorに移行する場合は、Model.bimファイルを持ってくるだけでよい。その代わり、Tabular EditorはモデルのメタデータをModel.bimファイルから直接読み込むだけです。場合によっては、Model.bimファイルの隣にTabular Model User Options (tmuo)ファイルと呼ばれるファイルが作成されます。このファイルはTabular Editorで使用され、ワークスペースデータベースを使用するかどうか、データソースの（暗号化された）ユーザー認証情報など、ユーザーおよびモデル固有の設定を保存します。

プロジェクト」ディレクトリをきれいに保つために、Visual Studioで作成したModel.bimファイルを新しいディレクトリにコピーしてから、Tabular Editorでファイルを読み込むことをお勧めします。

../images/te-file-structure.png

並行開発やバージョン管理システムとの統合に推奨されるSave-to-folder機能を使用したい場合は、Tabular Editor内からモデルをフォルダとして保存することをお勧めします（File > Save To Folder...）。

.../images/te-folder-structure.png

バージョン管理
Tabular Editorには、モデルのメタデータの統合されたバージョンコントロールはありません。しかし、すべてのモデルメタデータはディスク上のシンプルなテキスト（JSON）ファイルとして保存されているので、タブラーモデルのメタデータをあらゆる種類のバージョンコントロールシステムに含めることは簡単です。このため、ほとんどのTabular Editorユーザーは、Visual Studio Team Explorerや、特にgitについては、Visual Studio 2019の新しいGit Changesウィンドウにアクセスできるように、Visual Studioを引き続きインストールしておくことを希望しています。

ノート
最近では、ほとんどの開発者がバージョンコントロールシステムとしてgitを好んで使用しているようです。Tabular Editor 3のGit統合は、将来のアップデートで予定されています。

Tabular Editorに移行すると、Visual Studioで作成したオリジナルのTabularモデルプロジェクトとサポートファイルを保持する必要はありません。これまで通り、Visual Studio Team ExplorerまたはGit Changesウィンドウを使用して、コードの変更を見たり、バージョンコントロールブランチを管理したり、コードのチェックインやマージなどを行うことができます。

もちろん、ほとんどのバージョン管理システムには、Visual Studioに頼らずに使用できる独自のツールセットがあります。例えば、gitにはコマンドラインがありますし、TortoiseGitのようにWindowsのエクスプローラーと直接統合できる人気の高いツールもたくさんあります。

フォルダへの保存とバージョン管理
Save-to-folder オプションを使用する主な利点は、モデルのメタデータを大きな JSON ドキュメントにすべて保存するのではなく、複数の小さなファイルに分割して保存できることです。TOMの多くのプロパティは、オブジェクト(例えばテーブル、メジャー、カラム)の配列です。このようなオブジェクトはすべて明示的な名前を持っているので、配列内の順序は問題になりません。時々、JSONへのシリアライズ中に順序が変更されることがあり、これにより、ほとんどのバージョンコントロールシステムは、ファイルに変更が加えられたことを示します。しかし、この順序には何の意味もないので、この種の変更から発生する可能性のあるマージ・コンフリクトをわざわざ処理する必要はありません。

Save-to-Folderシリアライゼーションでは、JSONファイルで使用される配列の数が大幅に削減されます。これは、通常は配列として保存されるオブジェクトが、サブフォルダ内に保存される個々のファイルに分割されるためです。Tabular Editorがモデルのメタデータをディスクからロードするとき、これらのサブフォルダをすべて走査して、すべてのオブジェクトがTOMに正しくデシリアライズされるようにします。

このように、Save-to-Folderシリアライゼーションにより、複数の開発者が同じタブラーモデルを並行して変更した場合に、マージコンフリクトが発生する可能性が大幅に減少します。

UIの違い
このセクションでは、タブラーモデルの開発におけるTabular Editor 3とVisual Studioのユーザーインターフェースの最も重要な違いを示します。Visual Studioの熱心なユーザーであれば、Tabular Editor 3のユーザーインターフェースに違和感はないはずです。より詳細なウォークスルーをご希望の場合は、「ユーザーインターフェース」をご覧ください。

タブラー・モデル・エクスプローラーとTOMエクスプローラーの比較
Visual Studioでは、モデルのメタデータの階層的な概要はTabular Model Explorerで見ることができます。

../images/vs-tom-explorer.png

Tabular Editorでは、これはTOM Explorerビューと呼ばれます。タブラエディタでは、すべてのデータモデリングは、一般的にTOMエクスプローラで関連するオブジェクトを見つけ、右クリックのコンテキストメニューを呼び出したり、メインメニューに移動したり、プロパティビューでオブジェクトのプロパティを編集したりして、特定のアクションを実行することを中心に展開されます。タブラエディタでは、マルチセレクト、ドラッグドロップ、コピーペースト、アンドゥ・リドゥなどの直感的な操作で、すべてのデータモデリング操作を行うことができます。

.../images/tom-explorer.png

また、タブラエディタのTOMエクスプローラには、特定のタイプのオブジェクトの表示/非表示、隠しオブジェクト、表示フォルダ、メタデータ階層の迅速な検索とフィルタリングのためのショートカットオプションがあります。

詳細は「TOMエクスプローラビュー」を参照してください。

プロパティグリッド
Visual StudioとTabular Editorの両方にプロパティグリッドがあり、現在選択されているオブジェクトのほとんどのオブジェクトプロパティを編集することができます。以下は、同じメジャーのVisual Studioのプロパティグリッド(左)とTabular Editorのプロパティグリッド(右)の比較です。

../images/property-grid-vs-te.png

この2つは概ね同じように動作しますが、Tabular EditorではTOMオブジェクトのプロパティに近いプロパティ名を使用しています。また、タビュラー・エディターは、特定のモデリング操作を容易にするために、TOMにはない多くのプロパティを追加します。例えば、Translated Namesプロパティを拡張することで、すべてのモデルカルチャでオブジェクト名の翻訳を比較し、編集することができます。

DAX 式の編集
Visual Studioでは、数式バーを使用するか、Tabular Model Explorerのメジャーを右クリックして「Edit formula」を選択することで、DAXエディタ・ウィンドウを開くことができます。

Tabular Editorの動作もよく似ていますが、数式バーはExpression Editorビューに置き換えられています。さらに、スタンドアロン・ドキュメント内の 1 つまたは複数のオブジェクトの DAX 式を編集する場合は、それらのオブジェクト (メジャー、計算列、計算テーブル) を右クリックして、「スクリプト DAX」を選択します。

Tabular Editor 3のDAXコードエディタは、このツールを使用する主な理由の1つです。その詳細はこちらでご覧いただけます。

エラーリストとメッセージ表示
Visual Studio では、DAX の構文エラーはエラーリスト内に警告として表示されます (以下のスクリーンショットを参照)。また、エラーが発生したメジャーには、メジャー・グリッドに警告の三角マークが表示されます。

.../images/vs-error-list.png

タブラー・エディターでは、メッセージ・ビューを使用して、モデル開発中にさまざまなソースから投稿されたすべてのエラー、警告、情報メッセージを統合します。特にDAXの構文エラーについては、メッセージビューにエラーとして表示され、エラーが発生したメジャーはTOMエクスプローラに赤いドットで表示されます（以下のスクリーンショットを参照）。

../images/te-messages.png

上のスクリーンショットでは、3つの異なるメッセージ投稿ソースがあることに注目してください。

Analysis Servicesです。Analysis Services: メタデータの変更がAnalysis Servicesの接続されたインスタンスに保存されると、サーバーはTOMのメタデータを更新し、エラー状態のオブジェクトがあるかどうかを示します。具体的には、StateおよびErrorMessageプロパティが更新されます。Tabular Editorは、これらのエラーメッセージをメッセージビューに表示します。これらのメッセージは、Tabular Editorがオフライン（Analysis Servicesへの接続がない状態）で使用されている場合は表示されません。
タブラルエディタのセマンティック分析。さらに、Tabular Editor 3は、モデル内のすべてのDAX式に対して独自のセマンティック分析を行います。構文エラーやセマンティックエラーが発生した場合は、ここで報告されます。
式エディタ。最後に、Expression EditorなどのTabular Editor 3でドキュメントが開かれている場合、そのドキュメントで発生したDAXの構文エラーやセマンティックエラーがここで報告されます。
テーブルデータのプレビュー
Visual Studioでは、Model.bimファイルをロードすると、テーブルとそのコンテンツがタブビューに表示されます。Tabular Editor 3では、TOM Explorerでテーブルを右クリックして、Preview Dataを選択することで、テーブルデータをプレビューすることができます。これにより、新しいドキュメントタブが開き、テーブルのすべての行をスクロールしたり、列をフィルタリングしたりソートしたりすることができます。DirectQueryを使用したモデルにも対応しています。

また、ドキュメントを自由に並べ替えることで、複数のテーブルの内容を一度に見ることができます（下のスクリーンショットを参照）。

.../イメージ/te3-テーブル-プレビュー.png

テーブルのインポート
Tabular Editor 3 で新しいテーブルをインポートするには、「モデル」 > 「テーブルをインポート...」オプションを使用します。これにより、Tabular Editor 3のImport Table Wizardが起動し、データソースへの接続やインポートするテーブルの選択などのプロセスが案内されます。このプロセスは、Visual Studioの従来のテーブルインポートと比較的似ています。

重要な違いの1つは、Tabular Editor 3にはビジュアルなPower Query Editorが含まれていないことです。Power Query (M) 式をテキストとして編集することはできますが、Power Query クエリとして表現される複雑なデータ変換にモデルが大きく依存している場合は、Power Query クエリを編集する目的で Visual Studio の使用を継続することを検討する必要があります。

注意
Power Query を使用して複雑なデータ変換を行うことは、データ更新操作のオーバーヘッドが増加するため、一般的にエンタープライズデータモデリングにはお勧めできません。代わりに、他のETLツールを使ってデータをスタースキーマに準備し、スタースキーマのデータをSQL ServerやAzure SQL Databaseなどのリレーショナルデータベースに保存します。そして、そのデータベースから表計算モデルにテーブルをインポートします。

パーティションの編集とテーブルスキーマの更新
Tabular Editor 3では、テーブルの更新を強制することなく、テーブルのスキーマを更新することができます。パーティションは、TOMエクスプローラに個別のオブジェクトとして表示されます。パーティションをクリックすると、エクスプレッションエディタで式(MまたはSQL)を編集できます。

パーティション式が更新されると、Tabular Editorは、更新された式から得られるテーブルスキーマがモデルで定義された列のセットと異なるかどうかを自動的に検出することができます。スキーマの更新を行うには、TOMエクスプローラでパーティションまたはテーブルを右クリックし、Update table schema.... を選択します。

テーブルのインポートとスキーマの更新の詳細については、「（チュートリアル）テーブルのインポート」を参照してください。

リレーションシップの視覚化
Visual Studioには、テーブル間のリレーションシップを視覚化して作成できるダイアグラムツールがあります。

Tabular Editor 3にもダイアグラムツールがあり、ファイル > 新規作成 > ダイアグラムでアクセスできます。新しいダイアグラムドキュメントタブが作成され、その時点でTOMエクスプローラからドラッグ＆ドロップでテーブルを追加するか、ダイアグラム > テーブルの追加...メニューから追加することができます。

テーブルがダイアグラムに追加されると、1つのカラムから別のカラムにドラッグするだけで、カラム間のリレーションを作成することができます。

.../images/te3-diagram-view.png

注意
パフォーマンス上の理由から、ダイアグラム・ツールはモデルのデータを検査したり、作成したリレーションの一意性や方向性を検証したりしません。リレーションシップが正しく作成されているかどうかは、ユーザーに委ねられています。リレーションシップが正しく定義されていない場合、Analysis Services はメッセージ ビューに表示されるエラー状態を返します。

モデルの展開
Tabular Editorを使用すると、モデルのメタデータをAnalysis Servicesの任意のインスタンスに簡単に展開できます。Tabular Editorのデプロイ ウィザードは、[モデル] > [デプロイ...]で起動するか、CTRL+SHIFT+Dを押して起動します。

詳細については、「モデルのデプロイ」を参照してください。

次のステップ
タブラー・エディター2.xからの移行
GitとSave to Folderを使った並行開発の実現
Tabular Editor 3で生産性を向上させる